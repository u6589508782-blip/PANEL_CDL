<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CDL · Demo menús + Equipos</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#e8eef7; --line:#232b36;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:#0c0f14;color:var(--ink);font-family:Inter,system-ui,sans-serif}
.hidden{display:none!important}
.container{max-width:980px;margin:0 auto;padding:1rem}

/* ===== Header con logo difuminado y barra abajo ===== */
header{
  position:sticky; top:0; z-index:60;
  background:#fff; color:#000; min-height:100px; isolation:isolate; overflow:visible;
}
header::before{
  content:""; position:absolute; inset:0;
  background:url('logo_mantenimiento.png') center no-repeat;
  background-size:70%; opacity:.12; z-index:0; pointer-events:none;
}
.nav{
  display:flex; align-items:flex-end; gap:.8rem;
  padding:.6rem .9rem .4rem; min-height:100px; position:relative; z-index:1;
}
.grow{flex:1 1 auto}
.rolechip{font-size:.72rem;font-weight:800;color:#000;opacity:.9}

/* Menús */
.menu{position:relative}
.mbtn{
  border-radius:14px;background:#f1f1f1;color:#000;
  border:1px solid #ccc;box-shadow:inset 0 1px 0 rgba(255,255,255,.6),0 2px 8px rgba(0,0,0,.06);
  padding:.5rem .7rem;font-weight:800;cursor:pointer
}
.panel{
  position:absolute; right:0; top:calc(100% + 8px); z-index:1000;
  background:#0f141c; color:#e8eef7;
  border:1px solid #1e2a38; border-radius:16px;
  box-shadow:0 18px 36px rgba(0,0,0,.5); min-width:280px; overflow:hidden;
}
.row{padding:.85rem 1rem;border-bottom:1px solid #1e2a38}
.row:last-child{border-bottom:0}
.actions{display:flex;gap:.55rem;flex-direction:column}
.btn{border:0;border-radius:12px;padding:.6rem .9rem;font-weight:800;cursor:pointer}
#pagesPanel .btn{
  border-radius:999px;background:#0b0f15;color:#fff;border:1px solid #202a36;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08),0 6px 18px rgba(0,0,0,.35)
}

/* Tarjetas de equipos (simuladas) */
.card{
  background:#fff;color:#000;border:1px solid #ddd;border-radius:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.1); padding:1rem;margin:.55rem 0;
  display:flex; gap:1rem; align-items:center; flex-wrap:wrap;
}
.pilot{width:18px;height:18px;border-radius:50%;
  box-shadow:0 0 0 3px #fff,0 0 0 6px rgba(0,0,0,.06),inset 0 -3px 6px rgba(0,0,0,.15)}
.p-ok{background:#22c55e}
.p-warn{background:#f59e0b}
.p-stop{background:#ef4444}
.name{font-weight:800;font-size:1.14rem}
.sub{color:#475569}
.badge-chip{display:inline-flex;align-items:center;gap:.5rem;padding:.45rem .75rem;border-radius:999px;background:#f8fafc;border:1px solid #e2e8f0;font-weight:800;color:#111827}
</style>
</head>
<body>

<header>
  <div class="nav" id="navBar">
    <!-- Menú de páginas -->
    <div class="menu">
      <button id="pagesBtn" class="mbtn" aria-label="Menú" aria-expanded="false">☰</button>
      <div id="pagesPanel" class="panel hidden" style="min-width:260px">
        <div class="row">
          <div class="actions">
            <button class="btn" onclick="nav('equipos')">Equipos</button>
            <button class="btn" onclick="alert('Demo: otras páginas no incluidas')">Incidencias</button>
            <button class="btn" onclick="alert('Demo: otras páginas no incluidas')">OT</button>
            <button class="btn" onclick="alert('Demo: otras páginas no incluidas')">Inventario</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Título -->
    <div style="display:flex;flex-direction:column">
      <div style="display:flex;align-items:baseline;gap:.6rem">
        <span style="font-weight:800;font-size:1.55rem;letter-spacing:.02em">CDL</span>
        <span>·</span>
        <span style="font-weight:700;color:#000;opacity:.9">Panel de control (demo)</span>
      </div>
    </div>

    <div class="grow"></div>
    <span id="roleChip" class="rolechip">Demo</span>

    <!-- Menú de usuario -->
    <div class="menu">
      <button id="userBtn" class="mbtn" aria-label="Usuario" aria-expanded="false">⋮</button>
      <div id="userPanel" class="panel hidden">
        <div class="row">
          <strong>Usuario (demo)</strong>
          <div class="actions" style="margin-top:.6rem">
            <button class="btn" onclick="alert('Demo: login no implementado')">Entrar</button>
            <button class="btn" onclick="alert('Demo: logout no implementado')">Salir</button>
          </div>
        </div>
        <div class="row" style="font-size:.9rem;color:#cbd5e1">
          Este panel es una demo mínima para comprobar que los menús se abren/cierra correctamente.
        </div>
      </div>
    </div>
  </div>
</header>

<main class="container">
  <!-- Página: Equipos (simulada) -->
  <section id="page-equipos">
    <div style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;justify-content:center;margin:.4rem 0 1rem">
      <span class="badge-chip"><span style="width:10px;height:10px;background:#22c55e;border-radius:50%"></span> En marcha</span>
      <span class="badge-chip"><span style="width:10px;height:10px;background:#f59e0b;border-radius:50%"></span> Restricciones</span>
      <span class="badge-chip"><span style="width:10px;height:10px;background:#ef4444;border-radius:50%"></span> Parada</span>
    </div>
    <div id="equiposWrap"></div>
  </section>
</main>

<footer style="text-align:center;padding:2rem 1rem;color:#9aa7b4">Demo · © CDL</footer>

<script>
/* ===== Utilidades mínimas ===== */
const byId = id => document.getElementById(id);
function show(id){const n=byId(id); if(n) n.classList.remove('hidden')}
function hide(id){const n=byId(id); if(n) n.classList.add('hidden')}

/* ===== HOTFIX Menús (abrir/cerrar) ===== */
const pagesBtn   = byId('pagesBtn');
const userBtn    = byId('userBtn');
const pagesPanel = byId('pagesPanel');
const userPanel  = byId('userPanel');

function setExpanded(btn, open){ btn?.setAttribute('aria-expanded', open?'true':'false'); }
function openPanel(panelEl, btnEl){ panelEl?.classList.remove('hidden'); setExpanded(btnEl,true); }
function closePanel(panelEl, btnEl){ panelEl?.classList.add('hidden'); setExpanded(btnEl,false); }
function isOpen(panelEl){ return panelEl && !panelEl.classList.contains('hidden'); }
function closeAllMenus(){ closePanel(pagesPanel,pagesBtn); closePanel(userPanel,userBtn); }

// Evita múltiples bindings si el script se inyecta dos veces
if(!document.documentElement.dataset.menusBound){
  document.documentElement.dataset.menusBound = '1';

  const onTap = (el, handler) => {
    ['click','pointerdown'].forEach(ev => el?.addEventListener(ev, e=>{
      if(ev==='pointerdown' && e.button && e.button!==0) return;
      handler(e);
    }));
  };

  // Botón de páginas
  onTap(pagesBtn, (e)=>{
    e.stopPropagation();
    closePanel(userPanel, userBtn);
    isOpen(pagesPanel) ? closePanel(pagesPanel, pagesBtn) : openPanel(pagesPanel, pagesBtn);
  });

  // Botón de usuario
  onTap(userBtn, (e)=>{
    e.stopPropagation();
    closePanel(pagesPanel, pagesBtn);
    isOpen(userPanel) ? closePanel(userPanel, userBtn) : openPanel(userPanel, userBtn);
  });

  // No cerrar al interactuar dentro del panel
  ['click','pointerdown'].forEach(ev=>{
    pagesPanel?.addEventListener(ev, e=>e.stopPropagation());
    userPanel ?.addEventListener(ev, e=>e.stopPropagation());
  });

  // Cerrar al tocar/click fuera
  const isInside = (t, el)=> !!el && (el===t || el.contains(t));
  document.addEventListener('pointerdown', (e)=>{
    const t=e.target;
    const enPages = isInside(t,pagesPanel) || isInside(t,pagesBtn);
    const enUser  = isInside(t,userPanel)  || isInside(t,userBtn);
    if(!enPages && !enUser) closeAllMenus();
  }, true);

  // ESC cierra
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape') closeAllMenus();
  });

  // Accesibilidad teclado
  [pagesBtn,userBtn].forEach(btn=>{
    btn?.setAttribute('role','button');
    btn?.setAttribute('tabindex','0');
    btn?.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); btn.click(); }
    });
  });

  console.debug('[menus] bound OK (demo)');
}

/* ===== Navegación mínima ===== */
function nav(id){
  // en esta demo solo existe 'equipos', simplemente cerramos menús
  hide('pagesPanel'); hide('userPanel');
  setExpanded(pagesBtn,false); setExpanded(userBtn,false);
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ===== Datos simulados + render ===== */
const DEMO_EQUIPOS = [
  { nombre:'Línea 1 · Pulido', grupo:'L1', estado:'En marcha' },
  { nombre:'Línea 2 · Horno',  grupo:'L2', estado:'Restricciones' },
  { nombre:'Prensa 5',         grupo:'Prensas', estado:'Parada' }
];
function statusKey(s){return s==='Parada'?'stop':(s==='Restricciones'?'warn':'ok')}
function cardEquipo(eq){
  const el = document.createElement('div'); el.className='card';
  el.innerHTML = `
    <span class="pilot p-${statusKey(eq.estado)}"></span>
    <div>
      <div class="name">${eq.nombre}</div>
      <div class="sub">${eq.grupo}</div>
    </div>
  `;
  return el;
}
function renderEquipos(){
  const wrap = byId('equiposWrap'); wrap.innerHTML='';
  DEMO_EQUIPOS.forEach(e=>wrap.appendChild(cardEquipo(e)));
}
renderEquipos();
</script>
</body>
</html>