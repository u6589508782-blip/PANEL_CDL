<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>CDL · Incidencias (QR)</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --brand:#E43B3B;
      --ink:#0f172a;
      --muted:#475569;
      --line:#e5e7eb;
      --bg:#ffffff;

      --hdr-h:76px;
      --radius:8px;
      --shadow:0 2px 8px rgba(0,0,0,.06);

      --angular-size:26px;
      --angular-up:.72em;
      --angular-gap:20px;
    }

    *{box-sizing:border-box; min-width:0}
    html,body{height:100%; background:var(--bg); overflow-x:hidden; color:var(--ink)}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    img{display:block; max-width:100%; height:auto}
    button{font:inherit; cursor:pointer; background:transparent; border:0}
    :focus-visible{outline:2px solid #0ea5e9; outline-offset:2px}

    /* ===== CABECERA (misma idea que tu index: logo centrado) ===== */
    header{
      position:sticky; top:0; z-index:1000;
      background:#fff;
      border-bottom:1px solid #eee;
    }
    .hdr-in{
      height:var(--hdr-h);
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      padding:10px 12px;
    }
    .hdr-left{justify-self:start; font-weight:900; color:#111827; font-size:12px; opacity:.7}
    .hdr-center{justify-self:center}
    .hdr-center img{height:44px}
    .hdr-right{justify-self:end; font-weight:900; font-size:12px; color:#111827; opacity:.7}
    .hdr-sub{
      padding:0 12px 12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:stretch;
      border-bottom:1px solid #f1f5f9;
    }
    .hdr-block{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--line);
      background:#fff;
      border-radius:10px;
      box-shadow:var(--shadow);
      width:100%;
      font-weight:900;
      font-size:12px;
      color:#111827;
    }
    .hdr-block .lbl{
      color:#111827;
      opacity:.78;
      letter-spacing:.3px;
    }
    .hdr-block input[type="date"]{
      border:0;
      font:inherit;
      font-weight:900;
      background:transparent;
      padding:0;
      color:#111827;
    }
    .turnos{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .turnos label{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      white-space:nowrap;
    }
/* ===== TABS ===== */
    .tabs{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      padding:12px;
      position:sticky; top:var(--hdr-h); z-index:900;
      background:#fff;
      border-bottom:1px solid #f1f5f9;
    }
    .tabbtn{
      width:100%;
      display:flex; align-items:center; justify-content:center;
      padding:12px 10px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.55);
      background:#ffffff;
      color:var(--ink);
      font-weight:900;
      font-size:.95rem;
      box-shadow:var(--shadow);
    }
    .tabbtn[aria-selected="true"]{
      border-color: rgba(228,59,59,.55);
      box-shadow: 0 0 0 2px rgba(228,59,59,.12) inset, var(--shadow);
      position:relative;
    }
    .tabbtn[aria-selected="true"]::after{
      content:"";
      position:absolute;
      left:10px; right:10px; bottom:0;
      height:3px;
      background:var(--brand);
      border-radius:999px;
    }
/* ===== CONTENIDO ===== */
    main{max-width:980px; margin:0 auto; padding:14px 12px 0}
    .card{
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      box-shadow:var(--shadow);
      margin:10px 0;
    }
    h2,h3{
      position:relative;
      margin:18px 0 10px;
      padding-left:var(--angular-gap);
      line-height:1.15;
      font-weight:900;
    }
    h2{font-size:1.15rem}
    h3{font-size:1.02rem; color:#111827}
    h2{border-left:4px solid var(--brand); padding-left:calc(var(--angular-gap) + 6px)}
    h3{border-left:3px solid rgba(228,59,59,.75); padding-left:calc(var(--angular-gap) + 6px)}
    h2::before,h3::before{
      content:"";
      position:absolute; left:0; bottom:var(--angular-up);
      width:var(--angular-size); height:var(--angular-size);
      background:url("angular.png") left bottom/contain no-repeat;
      pointer-events:none;
    }

    .grid-2{display:grid; gap:10px; grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:820px){ .grid-2{grid-template-columns:1fr} }

    .list{
      border:1px dashed rgba(148,163,184,.55);
      border-radius:12px;
      padding:10px;
      background:#fcfcfd;
    }
    .list .item{
      display:flex; gap:10px; align-items:flex-start;
      padding:8px 8px;
      border-radius:10px;
      border:1px solid rgba(226,232,240,.85);
      background:#fff;
    }
    .list .item + .item{margin-top:8px}
    .list label{display:flex; gap:10px; width:100%; cursor:pointer}
    .list input{transform:translateY(2px)}
    .mono{font-variant-numeric:tabular-nums; font-feature-settings:"tnum" 1; letter-spacing:.01em}
    .muted{color:var(--muted); font-weight:800; font-size:12px}

    /* ===== FORM PIE ===== */
    .footgrid{display:grid; gap:10px; grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:820px){ .footgrid{grid-template-columns:1fr} }
    .field{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      background:#fff;
    }
    .field b{display:block; margin-bottom:6px}
    .opts{display:flex; flex-wrap:wrap; gap:10px}
    .opts label{display:inline-flex; gap:8px; align-items:center; font-weight:800}
    .wide{grid-column:1/-1}

    /* ===== DESPLEGABLES (categorías) ===== */
    details.cat{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      box-shadow:var(--shadow);
      margin:10px 0;
      overflow:hidden;
    }
    details.cat > summary{
      list-style:none;
      cursor:pointer;
      padding:12px;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    details.cat > summary::-webkit-details-marker{display:none}
    .cat-title{
      position:relative;
      margin:0;
      padding-left:var(--angular-gap);
      font-weight:900;
      font-size:1.05rem;
      line-height:1.15;
      border-left:4px solid var(--brand);
      padding-left:calc(var(--angular-gap) + 6px);
    }
    .cat-title::before{
      content:"";
      position:absolute; left:0; bottom:var(--angular-up);
      width:var(--angular-size); height:var(--angular-size);
      background:url("angular.png") left bottom/contain no-repeat;
      pointer-events:none;
    }
    .chev{
      width:38px; height:38px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.45);
      background:rgba(15,23,42,.03);
      display:flex; align-items:center; justify-content:center;
      flex:0 0 auto;
    }
    .chev svg{width:18px; height:18px}
    details[open] .chev svg{transform:rotate(180deg)}
    .cat-body{padding:0 12px 12px}

    textarea{
      width:100%;
      min-height:84px;
      resize:vertical;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      font:inherit;
    }
    .sign{
      display:grid; gap:10px; grid-template-columns:repeat(2,minmax(0,1fr));
    }
    @media (max-width:820px){ .sign{grid-template-columns:1fr} }
    .sign input{
      width:100%; padding:10px 12px; border-radius:12px;
      border:1px solid var(--line); font:inherit;
    }

    footer{
      margin:18px 0 14px;
      text-align:center;
      color:#64748b;
      font-size:12px;
    }
    .footer-img{
      margin:12px auto 0;
      max-width:980px;
      padding:0 12px 12px;
    }
    .footer-img img{
      width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
    }

    /* ===== resalta item si viene por QR con ?focus= ===== */
    .focus{
      outline:3px solid rgba(228,59,59,.35);
      box-shadow:0 0 0 2px rgba(228,59,59,.10) inset;
    }
  </style>
</head>

<body>
  <header>
    <div class="hdr-in">
      <div class="hdr-left">CDL</div>
      <div class="hdr-center">
        <img src="logo-cdl.png" alt="CDL" />
      </div>
      <div class="hdr-right">INCIDENCIAS</div>
    </div>
    <div class="hdr-sub">
      <div class="hdr-block">
        <span class="lbl">FECHA</span>
        <input id="fecha" type="date">
      </div>

      <div class="hdr-block">
        <span class="lbl">TURNO</span>
        <div class="turnos">
          <label><input type="checkbox"> Mañana</label>
          <label><input type="checkbox"> Tarde</label>
          <label><input type="checkbox"> Noche</label>
        </div>
      </div>

      <div class="hdr-block" id="focusInfo" style="display:none; grid-column:1/-1; justify-content:flex-start;">
        <span class="lbl">QR</span>
        <span style="font-weight:900; color:#111827;" id="focusText"></span>
      </div>
    </div>
  </header>

  <nav class="tabs" aria-label="Selector de hoja WAR">
    <button class="tabbtn" id="tabA" type="button" aria-selected="true">WAR · Puentes + Elevación + Auxiliares</button>
    <button class="tabbtn" id="tabB" type="button" aria-selected="false">WAR · Producción</button>
  </nav>

  <main>
    <!-- ===== HOJA A ===== -->
    <section id="panelA">
      <details class="cat" open>
  <summary>
    <h2 class="cat-title">Puentes grúa</h2>
    <span class="chev" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg></span>
  </summary>
  <div class="cat-body">
<div class="grid-2">
          <div class="list" aria-label="Nave 1">
            <h3>Nave 1</h3>
            <div class="item" id="eq-1.1"><label><input type="checkbox"><span class="mono">1.1 - GH - 2.2+2.2T</span> <span class="muted">(imanes)</span></label></div>
            <div class="item" id="eq-1.2"><label><input type="checkbox"><span class="mono">1.2 - DEMAG - 5+5T</span></label></div>
            <div class="item" id="eq-1.3"><label><input type="checkbox"><span class="mono">1.3 - DEMAG - 6.3+6.3T</span></label></div>
            <div class="item" id="eq-1.4"><label><input type="checkbox"><span class="mono">1.4 - GH - 6.3+6.3T</span></label></div>
          </div>

          <div class="list" aria-label="Nave 2">
            <h3>Nave 2</h3>
            <div class="item" id="eq-2.1"><label><input type="checkbox"><span class="mono">2.1 - Puente grúa con imanes</span></label></div>
            <div class="item" id="eq-2.2"><label><input type="checkbox"><span class="mono">2.2 - DEMAG - 5+5T</span> <span class="muted">(portador de imanes)</span></label></div>
            <div class="item" id="eq-2.3"><label><input type="checkbox"><span class="mono">2.3 - DEMAG - 6.3+6.3T</span></label></div>
            <div class="item" id="eq-2.4"><label><input type="checkbox"><span class="mono">2.4 - GH - 6.3+6.3T</span></label></div>
            <div class="item" id="eq-2.5"><label><input type="checkbox"><span class="mono">2.5 - GH - 5+5T</span></label></div>
          </div>

          <div class="list" aria-label="Nave 3">
            <h3>Nave 3</h3>
            <div class="item" id="eq-3.1"><label><input type="checkbox"><span class="mono">3.1 - ARAEL - 3.2+3.2T</span> <span class="muted">(imanes)</span></label></div>
            <div class="item" id="eq-3.2"><label><input type="checkbox"><span class="mono">3.2 - DEMAG - 5+5T</span></label></div>
            <div class="item" id="eq-3.3"><label><input type="checkbox"><span class="mono">3.3 - DEMAG - 6.3+6.3T</span></label></div>
            <div class="item" id="eq-3.4"><label><input type="checkbox"><span class="mono">3.4 - GH - 5+5T</span></label></div>
            <div class="item" id="eq-3.5"><label><input type="checkbox"><span class="mono">3.5 - GH - 5+5T</span></label></div>
            <div class="item" id="eq-3.6"><label><input type="checkbox"><span class="mono">3.6 - GH - 3.2+3.2T</span> <span class="muted">(descarga zona láser)</span></label></div>
            <div class="item" id="eq-3.7"><label><input type="checkbox"><span class="mono">3.7 - GH - 3.2+3.2T</span> <span class="muted">(descarga zona láser)</span></label></div>
          </div>

          <div class="list" aria-label="Nave 4">
            <h3>Nave 4</h3>
            <div class="item" id="eq-4.1"><label><input type="checkbox"><span class="mono">4.1 - GH - 2.2+2.2T</span> <span class="muted">(imanes)</span></label></div>
            <div class="item" id="eq-4.2"><label><input type="checkbox"><span class="mono">4.2 - DEMAG - 5+5T</span></label></div>
            <div class="item" id="eq-4.3"><label><input type="checkbox"><span class="mono">4.3 - DEMAG - 6.3+6.3T</span></label></div>
            <div class="item" id="eq-4.4"><label><input type="checkbox"><span class="mono">4.4 - GH - 10+10T</span></label></div>
            <div class="item" id="eq-4.5"><label><input type="checkbox"><span class="mono">4.5 - GH - 5+5T</span></label></div>
          </div>
        </div>
  </div>
</details>

      <details class="cat" open>
  <summary>
    <h2 class="cat-title">Sistemas de movilidad y transporte de cargas</h2>
    <span class="chev" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg></span>
  </summary>
  <div class="cat-body">
<div class="list">
          <div class="item" id="eq-29"><label><input type="checkbox"><span class="mono">29 - Carro de transporte transversal 1</span></label></div>
          <div class="item" id="eq-30"><label><input type="checkbox"><span class="mono">30 - Carro de transporte transversal 2</span></label></div>
          <div class="item" id="eq-31"><label><input type="checkbox"><span class="mono">31 - Carretilla elevadora LINDE 1</span></label></div>
          <div class="item" id="eq-32"><label><input type="checkbox"><span class="mono">32 - Carretilla elevadora LINDE 2</span></label></div>
          <div class="item" id="eq-33"><label><input type="checkbox"><span class="mono">33 - Transpaleta eléctrica</span></label></div>
          <div class="item" id="eq-34"><label><input type="checkbox"><span class="mono">34 - Transpaleta eléctrica</span></label></div>
          <div class="item" id="eq-35"><label><input type="checkbox"><span class="mono">35 - Plataforma elevadora articulada</span></label></div>
        </div>
  </div>
</details>

      <details class="cat" open>
  <summary>
    <h2 class="cat-title">Equipos auxiliares</h2>
    <span class="chev" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg></span>
  </summary>
  <div class="cat-body">
<div class="list">
          <div class="item" id="eq-19"><label><input type="checkbox"><span class="mono">19 - Compresor principal de aire comprimido</span></label></div>
          <div class="item" id="eq-20"><label><input type="checkbox"><span class="mono">20 - Transformador general</span></label></div>
          <div class="item" id="eq-21"><label><input type="checkbox"><span class="mono">21 - Protecciones eléctricas generales</span></label></div>
          <div class="item" id="eq-22"><label><input type="checkbox"><span class="mono">22 - Iluminación general almacén</span></label></div>
          <div class="item" id="eq-23"><label><input type="checkbox"><span class="mono">23 - Infraestructura (techos, puertas, marquesinas y vallados)</span></label></div>
          <div class="item" id="eq-24"><label><input type="checkbox"><span class="mono">24 - Instalaciones de riesgo con agua técnica e higiénico-sanitaria</span></label></div>
          <div class="item" id="eq-25"><label><input type="checkbox"><span class="mono">25 - Refrigeración cuarto de servidores</span></label></div>
          <div class="item" id="eq-26"><label><input type="checkbox"><span class="mono">26 - Puertas de acceso motorizadas y comunicación</span></label></div>
          <div class="item" id="eq-27"><label><input type="checkbox"><span class="mono">27 - Sistema contraincendios</span></label></div>
          <div class="item" id="eq-28"><label><input type="checkbox"><span class="mono">28 - Circuito cerrado de gas</span></label></div>
          <div class="item" id="eq-36"><label><input type="checkbox"><span class="mono">36 - Barredora Tennant</span></label></div>
          <div class="item" id="eq-37"><label><input type="checkbox"><span class="mono">37 - Aspirador manual Tennant</span></label></div>
          <div class="item" id="eq-38"><label><input type="checkbox"><span class="mono">38 - Aspirador manual granalla</span></label></div>
        </div>
  </div>
</details>
    </section>

    <!-- ===== HOJA B ===== -->
    <section id="panelB" hidden>
      <details class="cat" open>
  <summary>
    <h2 class="cat-title">Línea Kaltenbach</h2>
    <span class="chev" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg></span>
  </summary>
  <div class="cat-body">
<div class="list">
          <div class="item" id="eq-1"><label><input type="checkbox"><span class="mono">1 - Sierra KBS + bancadas entrada y salida</span></label></div>
          <div class="item" id="eq-2"><label><input type="checkbox"><span class="mono">2 - KDP1 + bancadas entrada y salida</span></label></div>
          <div class="item" id="eq-3"><label><input type="checkbox"><span class="mono">3 - KDP3 + bancadas entrada y salida</span></label></div>
          <div class="item" id="eq-4"><label><input type="checkbox"><span class="mono">4 - Transporte T13 (camino de rodillos central)</span></label></div>
          <div class="item" id="eq-5"><label><input type="checkbox"><span class="mono">5 - Área de pintura + bancadas entrada y salida</span></label></div>
          <div class="item" id="eq-6"><label><input type="checkbox"><span class="mono">6 - Salidas Q8 y Q9</span></label></div>
          <div class="item" id="eq-9"><label><input type="checkbox"><span class="mono">9 - Vallado y seguridades</span></label></div>
        </div>
  </div>
</details>

      <details class="cat" open>
  <summary>
    <h2 class="cat-title">Equipos independientes</h2>
    <span class="chev" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg></span>
  </summary>
  <div class="cat-body">
<div class="list">
          <div class="item" id="eq-7"><label><input type="checkbox"><span class="mono">7 - KDM + bancadas entrada y salida</span></label></div>
          <div class="item" id="eq-8"><label><input type="checkbox"><span class="mono">8 - Sierra de paquetes + bancadas entrada y salida</span></label></div>
          <div class="item" id="eq-10"><label><input type="checkbox"><span class="mono">10 - HGG Perfilado térmico</span></label></div>
          <div class="item" id="eq-11"><label><input type="checkbox"><span class="mono">11 - TECOI (THOR)</span></label></div>
          <div class="item" id="eq-12"><label><input type="checkbox"><span class="mono">12 - Mazak FG-400 NEO</span></label></div>
        </div>
  </div>
</details>

      <details class="cat" open>
  <summary>
    <h2 class="cat-title">Láser TRUMPF</h2>
    <span class="chev" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg></span>
  </summary>
  <div class="cat-body">
<div class="list">
          <div class="item" id="eq-13"><label><input type="checkbox"><span class="mono">13 - Láser T12-2</span></label></div>
          <div class="item" id="eq-14"><label><input type="checkbox"><span class="mono">14 - Láser T12-1</span></label></div>
          <div class="item" id="eq-15"><label><input type="checkbox"><span class="mono">15 - Láser T7-1</span></label></div>
          <div class="item" id="eq-16"><label><input type="checkbox"><span class="mono">16 - Láser T7-2</span></label></div>
          <div class="item" id="eq-17"><label><input type="checkbox"><span class="mono">17 - Láser T11-1</span></label></div>
          <div class="item" id="eq-18"><label><input type="checkbox"><span class="mono">18 - Láser T11-2</span></label></div>
        </div>
  </div>
</details>
    </section>

    <!-- ===== PIE COMÚN (igual para ambas hojas) ===== -->
    <article class="card">
      <h2>Datos de la incidencia</h2>

      <div class="footgrid">
        <div class="field">
          <b>Tipo de incidencia</b>
          <div class="opts">
            <label><input type="checkbox"> Eléctrica</label>
            <label><input type="checkbox"> Mecánica</label>
            <label><input type="checkbox"> Neumática</label>
            <label><input type="checkbox"> Hidráulica</label>
            <label><input type="checkbox"> Proceso</label>
            <label><input type="checkbox"> Desconocido</label>
          </div>
        </div>

        <div class="field">
          <b>Afectación a producción</b>
          <div class="opts">
            <label><input type="checkbox"> Máquina parada</label>
            <label><input type="checkbox"> Producción reducida</label>
            <label><input type="checkbox"> No afecta</label>
          </div>
        </div>

        <div class="field">
          <b>Tiempo de paro</b>
          <div class="opts">
            <label><input type="checkbox"> &lt;15</label>
            <label><input type="checkbox"> 15–30</label>
            <label><input type="checkbox"> 30–60</label>
            <label><input type="checkbox"> &gt;1h</label>
          </div>
        </div>

        <div class="field">
          <b>Estado</b>
          <div class="opts">
            <label><input type="checkbox"> Solucionado</label>
            <label><input type="checkbox"> Parcial</label>
            <label><input type="checkbox"> Pendiente</label>
          </div>
        </div>

        <div class="field wide">
          <div class="sign">
            <div>
              <b>Reportado por</b>
              <input type="text" placeholder="Nombre" />
            </div>
            <div>
              <b>Intervenido por</b>
              <input type="text" placeholder="Nombre" />
            </div>
          </div>
        </div>

        <div class="field wide">
          <b>Observaciones <span class="muted">(descripción de falla / causa si se conoce)</span></b>
          <textarea placeholder="Escribe aquí…"></textarea>
        </div>
      </div>
    </article>

    <footer>© CDL — Incidencias (acceso directo por QR)</footer>
  </main>

  <div class="footer-img">
    <img src="conjunto.jpeg" alt="Conjunto web CDL" />
  </div>

  <script>
    // Tabs
    const tabA = document.getElementById('tabA');
    const tabB = document.getElementById('tabB');
    const panelA = document.getElementById('panelA');
    const panelB = document.getElementById('panelB');

    function setTab(which){
      const a = (which === 'A');
      tabA.setAttribute('aria-selected', a ? 'true' : 'false');
      tabB.setAttribute('aria-selected', a ? 'false' : 'true');
      panelA.hidden = !a;
      panelB.hidden = a;
      // guarda preferencia
      try{ localStorage.setItem('cdl_war_tab', which); }catch(e){}
    }

    tabA.addEventListener('click', ()=> setTab('A'));
    tabB.addEventListener('click', ()=> setTab('B'));

    // Fecha por defecto hoy
    (function(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const inp = document.getElementById('fecha');
      if(inp) inp.value = `${yyyy}-${mm}-${dd}`;
    })();

    // Focus por QR: ?focus=eq-7 o ?focus=7 o ?focus=1.3 etc.
    (function(){
      const qs = new URLSearchParams(location.search);
      const focus = (qs.get('focus')||'').trim();
      const tab = (qs.get('tab')||'').trim().toUpperCase();
      const info = document.getElementById('focusInfo');
      const infoText = document.getElementById('focusText');

      // restaura tab (o usa la query)
      let saved = 'A';
      try{ saved = localStorage.getItem('cdl_war_tab') || 'A'; }catch(e){}
      if(tab === 'A' || tab === 'B') saved = tab;
      setTab(saved);

      if(!focus) return;

      // Normaliza: si viene "7" => "eq-7"; si viene "1.3" => "eq-1.3"; si ya viene "eq-..." lo dejamos.
      const id = focus.startsWith('eq-') ? focus : `eq-${focus}`;
      const el = document.getElementById(id);
      if(!el) return;

      // Si está dentro de un desplegable, ábrelo
      const det = el.closest('details');
      if(det) det.open = true;

      // Si el elemento está en el otro panel, cambia de tab automáticamente
      const isInB = panelB.contains(el);
      const isInA = panelA.contains(el);
      if(isInB) setTab('B');
      if(isInA) setTab('A');

      setTimeout(()=>{
        el.classList.add('focus');
        el.scrollIntoView({behavior:'smooth', block:'center'});
        if(info){
          info.style.display = 'inline-flex';
          if(infoText) infoText.textContent = `Enfocado: ${focus}`;
        }
      }, 60);
    })();
  </script>
</body>
</html>
